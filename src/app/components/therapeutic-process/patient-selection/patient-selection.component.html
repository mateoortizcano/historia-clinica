<div class="patient-selection-container">
  <div class="container-fluid py-4">
    <div class="row">
      <div class="col-12">
        <!-- Header -->
        <div class="mb-4">
          <h1 class="page-title">Seleccionar Paciente</h1>
          <p class="page-description">
            Busque y seleccione el paciente para gestionar su proceso terapéutico.
          </p>
        </div>

        <!-- Search Card -->
        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <form [formGroup]="searchForm">
              <div class="row g-3 align-items-end">
                <div class="col-md-10">
                  <label for="searchTerm" class="form-label">
                    <i class="bi bi-search me-1"></i>
                    Buscar Paciente
                  </label>
                  <input
                    type="text"
                    id="searchTerm"
                    formControlName="searchTerm"
                    class="form-control form-control-lg"
                    placeholder="Buscar por nombre, número de identificación o teléfono..."
                  />
                  <div class="form-text">
                    Puede buscar por nombre completo, documento de identidad o número de teléfono
                  </div>
                </div>
                <div class="col-md-2">
                  <button
                    type="button"
                    class="btn btn-success w-100"
                    (click)="goToPatientRegistration()"
                  >
                    <i class="bi bi-person-plus me-1"></i>
                    Nuevo Paciente
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Results Info -->
        @if (searchTerm()) {
          <div class="alert alert-info mb-3">
            <i class="bi bi-info-circle me-2"></i>
            Se encontraron <strong>{{ filteredPatients().length }}</strong> paciente(s) con el término "{{ searchTerm() }}"
          </div>
        }

        <!-- Patients List -->
        <div class="card shadow-sm">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="bi bi-people me-2"></i>
              Pacientes Registrados ({{ filteredPatients().length }})
            </h5>
          </div>
          <div class="card-body p-0">
            @if (filteredPatients().length === 0) {
              <div class="empty-state text-center py-5">
                <i class="bi bi-inbox display-1 text-muted"></i>
                <h4 class="mt-3">No se encontraron pacientes</h4>
                <p class="text-muted">
                  @if (searchTerm()) {
                    No hay pacientes que coincidan con su búsqueda.
                  } @else {
                    No hay pacientes registrados en el sistema.
                  }
                </p>
                <button
                  type="button"
                  class="btn btn-primary mt-2"
                  (click)="goToPatientRegistration()"
                >
                  <i class="bi bi-person-plus me-2"></i>
                  Registrar Primer Paciente
                </button>
              </div>
            } @else {
              <div class="list-group list-group-flush">
                @for (patient of filteredPatients(); track patient.id) {
                  <button
                    type="button"
                    class="list-group-item list-group-item-action patient-item"
                    (click)="selectPatient(patient.id)"
                  >
                    <div class="d-flex w-100 justify-content-between align-items-start">
                      <div class="flex-grow-1">
                        <div class="d-flex align-items-center mb-2">
                          <h5 class="mb-0 me-3">{{ patient.fullName }}</h5>
                          <span
                            [class]="'badge ' + getStatusBadgeClass(patient)"
                          >
                            {{ getStatusText(patient) }}
                          </span>
                        </div>
                        <div class="patient-details">
                          <span class="detail-item">
                            <i class="bi bi-card-text me-1"></i>
                            <strong>ID:</strong> {{ patient.idNumber }}
                          </span>
                          <span class="detail-item">
                            <i class="bi bi-calendar3 me-1"></i>
                            <strong>Edad:</strong> {{ patient.age }} años
                          </span>
                          @if (patient.phone) {
                            <span class="detail-item">
                              <i class="bi bi-telephone me-1"></i>
                              {{ patient.phone }}
                            </span>
                          }
                        </div>
                        @if (patient.closedProcesses > 0) {
                          <div class="mt-2">
                            <small class="text-muted">
                              <i class="bi bi-archive me-1"></i>
                              {{ patient.closedProcesses }} proceso(s) cerrado(s)
                            </small>
                          </div>
                        }
                      </div>
                      <div class="ms-3">
                        <i class="bi bi-chevron-right text-muted"></i>
                      </div>
                    </div>
                  </button>
                }
              </div>
            }
          </div>
        </div>

        <!-- Help Section -->
        <div class="card border-light bg-light mt-4">
          <div class="card-body">
            <h6 class="card-title">
              <i class="bi bi-lightbulb me-2"></i>
              ¿Cómo funciona?
            </h6>
            <ol class="mb-0">
              <li>Busque y seleccione un paciente de la lista</li>
              <li>Visualice los procesos terapéuticos activos o cerrados del paciente</li>
              <li>Inicie un nuevo proceso o continúe con uno existente</li>
              <li>Agregue sesiones conforme realice las citas con el paciente</li>
            </ol>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

